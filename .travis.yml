language: node_js
node_js:
  - '8'
notifications: # 성공 실패 여부 알림
  email:
    recipients:
      - rb7480@naver.com
cache:
  directories:
    - 'node_modules'
branches:
  only:
    - master
    - develop
install:
  - npm i -g travis-ci-cloudfront-invalidation
  - cp .env.production .env
  - cat .env
  - npm install
  - npm run generate
script:
  - echo "Skipping tests"

deploy:
  - provider: s3
    access_key_id: $AWS_ACCESS_KEY
    secret_access_key: $AWS_SECRET_KEY
    bucket: togo82.com
    region: ap-northeast-2
    local_dir: dist
    skip_cleanup: true
    env:
     - VAR_CF_ID: $CF_ID_develop
    on:
      branch: master
  - provider: s3
    access_key_id: $AWS_ACCESS_KEY
    secret_access_key: $AWS_SECRET_KEY
    bucket: cheolgyu.com
    region: ap-northeast-2
    local_dir: dist
    skip_cleanup: true
    env:
     - VAR_CF_ID: $CF_ID
    on:
      branch: develop
    
after_deploy: 
    - if [ $TRAVIS_BRANCH == 'develop' ];
      then echo 11; travis-ci-cloudfront-invalidation -a $AWS_ACCESS_KEY -s $AWS_SECRET_KEY -c $CF_ID_develop -i '/*' -b $TRAVIS_BRANCH -p $TRAVIS_PULL_REQUEST;
      else  echo 22; travis-ci-cloudfront-invalidation -a $AWS_ACCESS_KEY -s $AWS_SECRET_KEY -c $CF_ID -i '/*' -b $TRAVIS_BRANCH -p $TRAVIS_PULL_REQUEST;
      fi